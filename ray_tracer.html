<!DOCTYPE html>

<html>
<head>
<title>Ray Tracer</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<!--
The simple vertex and fragment shaders.
Using a vertex coordinate buffer and a vertex colour buffer.
Passing the Model-View Matrix and the Projection Matrix.
-->

<script id="shader-vs" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
    varying vec4 vertexColor;

    // Lightsource

    attribute vec3 vNormal;
    uniform vec4 lightPosition;
    uniform vec4 viewerPosition;

    // The light intensity multiplied by the material reflection coefficients

    uniform vec3 ambientProduct;
    uniform vec3 diffuseProduct;
    uniform vec3 specularProduct;
    uniform float shininess;

    void main(void) {
        // To allow seeing the points drawn
        gl_PointSize = 5.0;
        // Just converting the (x,y,z) vertices to Homogeneous Coord.
        // And multiplying by the Projection and the Model-View matrix
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        // Converting the RGB color value to RGBA
        vec3 pos = (uMVMatrix * vec4(aVertexPosition, 1.0)).xyz;

        // vector from vertex position to light source

        vec3 L;

        // check for directional light

        if(lightPosition.w == 0.0) // Directional

            L = normalize( lightPosition.xyz );

        else  // Omni

            L = normalize( lightPosition.xyz - pos );

        // Vector from the vertex position to the eye

        vec3 E;

        // The viewer is at the origin or at an indefinite distance
        // on the ZZ axis

        if(viewerPosition.w == 1.0)

            // At the origin

            E = -normalize( pos );

        else

            // On the ZZ axis

            E = vec3(0,0,1);

        // Halfway vector

        vec3 H = normalize( L + E );

        // Transform vertex normal into eye coordinates

        vec4 N = normalize( uMVMatrix * vec4(vNormal, 0.0));

        // Compute terms in the illumination equation

        // Ambient component is constant

        vec4 ambient = vec4( ambientProduct, 1.0 );

        // Diffuse component

        float dotProductLN = L[0] * N[0] + L[1] * N[1] + L[2] * N[2];

        float cosNL = max( dotProductLN, 0.0 );

        vec4  diffuse = vec4( diffuseProduct * cosNL, 1.0 );

        // Specular component

        float dotProductNH = N[0] * H[0] + N[1] * H[1] + N[2] * H[2];

        float cosNH = pow( max( dotProductNH, 0.0 ), shininess );

        vec4  specular = vec4( specularProduct * cosNH, 1.0 );

        if( dotProductLN < 0.0 ) {

            specular = vec4(0.0, 0.0, 0.0, 1.0);
        }

        // Adding the 3 components

        vertexColor = ambient + diffuse + specular;
    }

</script>

<script id="shader-fs" type="x-shader/x-fragment">

    precision mediump float;
    varying vec4 vertexColor;
    void main(void) {
        // Using the passed vertex color
        gl_FragColor = vertexColor;
    }

</script>

<!-- The JS files -->
<!-- Some useful functions for browser compatibility -->
<script type="text/javascript" src="webgl-utils.js"></script>

<!-- Handling vectors and matrices -->
<script type="text/javascript" src="math.js"></script>
<script type="text/javascript" src="vector.js"></script>
<script type="text/javascript" src="matrix.js"></script>

<!-- Processing triangle mesh models -->
<script type="text/javascript" src="models-operations.js"></script>

<!-- WebGL code -->
<script type="text/javascript" src="initShaders.js"></script>
<script type="text/javascript" src="model.js"></script>
<script type="text/javascript" src="scene.js"></script>
<script type="text/javascript" src="myobject.js"></script>
<script type="text/javascript" src="glmodel.js"></script>
<script type="text/javascript" src="ray_tracer.js"></script>
<script type="text/javascript" src="lightsource.js"></script>
<script type="text/javascript" src="camera.js"></script>
<script type="text/javascript" src="material.js"></script>
<script type="text/javascript" src="ray.js"></script>


</head>

<body onload="runWebGL();">
    <div style="text-align: center">
        <p>Ray Tracing</p>

        <canvas id="canvasl" style="border:1px solid #000000;" width="350" height="350"></canvas>
        <canvas id="canvasr" style="border:1px solid #000000;" width="350" height="350"></canvas>

        <p>Read a 3D model from a text file and add it to scene:
        <input type="file" id="file" name="file">
        </p>
        <p>Read a 3D model from a <b>OBJ file</b>:
        <input type="file" id="obj-file" name="file">
        </p>

        <p>Choose the <b>rendering mode</b>:
        <select id="rendering-mode-selection">
            <option value="0">Filled Triangles</option>
            <option value="1">Wireframe</option>
            <option value="2">Vertices</option>
        </select>

        <p>
            <button id = "add-cube"> Add Cube</button>
            <button id = "add-pyramid"> Add Pyramid</button>
        </p>

    </div>
</body>
</html>
